{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center">{% if editing %}Edit Trip{% else %}Create a New Trip{% endif %}</h2>
    
    <!-- Progress Bar -->
    <div class="progress mt-4">
        <div class="progress-bar" role="progressbar" id="progressBar">Step 1 of 5</div>
    </div>

    <form method="POST" id="tripForm">
        {% csrf_token %}

        <!-- Basic Trip Details -->
        <fieldset class="form-step active">
            <legend>Step 1: Basic Trip Details</legend>

            <div class="mb-3">
                {{ form.trip_name|as_crispy_field }}
            </div>

            <div class="mb-3">
                <label for="id_country">Country:</label>
                <input type="text" id="id_country" class="form-control" placeholder="Start typing a country..." required>
            </div>

            <div class="mb-3">
                <label for="cities">Select Cities:</label>
                <input type="text" id="cities" class="form-control" placeholder="Start typing a city..." required>
                <ul id="selected-cities" class="list-group mt-2"></ul>
                <input type="hidden" name="selected-cities" id="selected-cities_input">
                <span id="city-error" class="text-danger"></span>  
            </div>

            <button type="button" class="btn btn-primary next-step">Next</button>
        </fieldset>

        <!-- Travel Dates & Budget -->
        <fieldset class="form-step">
            <legend>Step 2: Travel Dates & Budget</legend>

            <div class="row">
                <div class="col-md-6">
                    <label for="start_date">Start Date:</label>
                    <input type="date" id="start_date" name="start_date" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label for="end_date">End Date:</label>
                    <input type="date" id="end_date" name="end_date" class="form-control" required>
                </div>
            </div>

            <div class="mt-3">
                {{ form.budget|as_crispy_field }}
            </div>

            <button type="button" class="btn btn-secondary prev-step">Back</button>
            <button type="button" class="btn btn-primary next-step">Next</button>
        </fieldset>

        <!-- Accommodation & Transport -->
        <fieldset class="form-step">
            <legend>Step 3: Accommodation & Transport</legend>
            {{ form.accommodation_name|as_crispy_field }}
            {{ form.accommodation_type|as_crispy_field }}
            {{ form.transport_mode|as_crispy_field }}

            <button type="button" class="btn btn-secondary prev-step">Back</button>
            <button type="button" class="btn btn-primary next-step">Next</button>
        </fieldset>

        <!-- Itinerary-->
        <fieldset class="form-step">
            <legend>Step 4: Itinerary</legend>

            <div id="itinerary-container">
                <!-- Day 1 shows -->
                <div class="itinerary-day" id="day-1">
                    <h6>Day 1</h6>
                    <label>Morning:</label>
                    <input type="text" class="form-control" name="itinerary[1][morning]">

                    <label>Afternoon:</label>
                    <input type="text" class="form-control" name="itinerary[1][afternoon]">

                    <label>Evening:</label>
                    <input type="text" class="form-control" name="itinerary[1][evening]">
                </div>
            </div>
            <button type="button" class="btn btn-sm btn-success mt-2" id="add-day">+ Add Day</button>
            <!--Hidden until button clicked-->
            <template id="day-template">
                <div class="itinerary-day">
                    <h6>Day <span class="day-number"></span></h6>
                    <label>Morning:</label>
                    <input type="text" class="form-control" name="morning">
        
                    <label>Afternoon:</label>
                    <input type="text" class="form-control" name="afternoon">
        
                    <label>Evening:</label>
                    <input type="text" class="form-control" name="evening">
        
                    <button type="button" class="btn btn-danger btn-sm remove-day mt-2">Remove Day</button>
                </div>
            </template>
    
    <button type="button" class="btn btn-secondary prev-step">Back</button>
    <button type="button" class="btn btn-primary next-step">Next</button>
</fieldset>

        <!-- Review & Submit -->
        <fieldset class="form-step">
            <legend>Step 5: Review & Submit</legend>
            <p>Review your trip details before submitting.</p>

            <button type="button" class="btn btn-secondary prev-step">Back</button>
            <button type="submit" class="btn btn-success">{% if editing %}Update Trip{% else %}Submit Trip{% endif %}</button>
        </fieldset>
    </form>
</div>

{% endblock %}

{% block extra_js %}
{% if google_api_key %}
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}&libraries=places"></script>
{% endif %}

<script src="{% static 'js/trip_form.js' %}"></script>
{% endblock %}
