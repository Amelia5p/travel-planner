{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center">Create a New Trip</h2>
    
    <!-- Progress Bar -->
    <div class="progress mt-4">
        <div class="progress-bar" role="progressbar" id="progressBar">Step 1 of 5</div>
    </div>

    <form method="POST" id="tripForm">
        {% csrf_token %}

        <!-- Step 1: Basic Trip Details -->
        <fieldset class="form-step active">
            <legend>Step 1: Basic Trip Details</legend>

            <div class="mb-3">
                {{ form.trip_name|as_crispy_field }}
            </div>

            <div class="mb-3">
                <label for="id_country">Country:</label>
                <input type="text" id="id_country" class="form-control" placeholder="Start typing a country..." required>
            </div>

            <div class="mb-3">
                <label for="cities">Select Cities:</label>
                <input type="text" id="cities" class="form-control" placeholder="Start typing a city..." required>
                <ul id="selected-cities" class="list-group mt-2"></ul>
                <input type="hidden" name="selected-cities" id="selected-cities_input">
                <span id="city-error" class="text-danger"></span>  
            </div>

            <button type="button" class="btn btn-primary next-step">Next</button>
        </fieldset>

        <!-- Step 2: Travel Dates & Budget -->
        <fieldset class="form-step">
            <legend>Step 2: Travel Dates & Budget</legend>

            <div class="row">
                <div class="col-md-6">
                    <label for="start_date">Start Date:</label>
                    <input type="date" id="start_date" name="start_date" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label for="end_date">End Date:</label>
                    <input type="date" id="end_date" name="end_date" class="form-control" required>
                </div>
            </div>

            <div class="mt-3">
                {{ form.budget|as_crispy_field }}
            </div>

            <button type="button" class="btn btn-secondary prev-step">Back</button>
            <button type="button" class="btn btn-primary next-step">Next</button>
        </fieldset>

        <!-- Step 3: Accommodation & Transport -->
        <fieldset class="form-step">
            <legend>Step 3: Accommodation & Transport</legend>
            {{ form.accommodation_name|as_crispy_field }}
            {{ form.accommodation_type|as_crispy_field }}
            {{ form.transport_mode|as_crispy_field }}

            <button type="button" class="btn btn-secondary prev-step">Back</button>
            <button type="button" class="btn btn-primary next-step">Next</button>
        </fieldset>

        <!-- Step 4: Itinerary & Wishlist -->
        <fieldset class="form-step">
            <legend>Step 4: Itinerary & Wishlist</legend>

            <div class="mb-3">
                <label for="itinerary">Daily Itinerary</label>
                <textarea class="form-control" name="itinerary" id="itinerary" rows="3"></textarea>
            </div>

            <div class="mb-3">
                <label for="wishlist">Add places to your wishlist:</label>
                <input type="text" id="wishlist" class="form-control" placeholder="Search places..." required>
            </div>

            <button type="button" class="btn btn-secondary prev-step">Back</button>
            <button type="button" class="btn btn-primary next-step">Next</button>
        </fieldset>

        <!-- Step 5: Review & Submit -->
        <fieldset class="form-step">
            <legend>Step 5: Review & Submit</legend>
            <p>Review your trip details before submitting.</p>

            <button type="button" class="btn btn-secondary prev-step">Back</button>
            <button type="submit" class="btn btn-success">Submit Trip</button>
        </fieldset>
    </form>
</div>
{% endblock %}

{% block extra_js %}
{% if google_api_key %}
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}&libraries=places"></script>
{% endif %}

<script src="{% static 'js/trip_form.js' %}"></script>
{% endblock %}
